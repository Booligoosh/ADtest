<html>
  <head>
    <title>ADtest</title>
    <script src="/jquery.min.js"></script>
    <script src="/urlParams/urlParams.js"></script>
  </head>
  <body>
    <div class="result">
    </div>
    <script>
      const toDataURL = url => fetch(url)
        .then(response => response.blob())
        .then(blob => new Promise((resolve, reject) => {
          var reader = new FileReader();
          reader.onloadend = () => resolve(reader.result);
          reader.onerror = reject;
          reader.readAsDataURL(blob);
      }));
      var url = null;
      if (urlParams.url == undefined) {
        while (url == null) {
          url = prompt("URL to get:");
          //window.location = "https://booligoosh.github.io/ADtest/index.html?url=" + url;
        }
      }
      else {
        url = urlParams.url;
      }
      var preserveData = "";
      $.get( "https://cors-anywhere.herokuapp.com/" + url, function( data ) {
        $( ".result" ).html( "\"\"" + data + "\"\"" );
        preserveData = data;
        //alert( "Load was performed." );
      });
      setTimeout(useData,1001);
      function useData() {
        //alert(preserveData);
        $( ".result" ).html(preserveData);
        setTimeout(addImages,1001);
      }
      function addImages() {
        var imgs = document.getElementsByTagName('img');
        var i = 0;
        imgRep()
        
      }
      function imgRep() {
        console.log('hey');
        toDataURL('https://cors-anywhere.herokuapp.com/' + imgs[i].src)
          .then(result => imgs[i].src = result)
          .catch(error => console.error(error)); ;
        i++;
        if (i < imgs.length) {
          setTimeout(imgRep,1001);
        }
      }
    </script>
  </body>
</html>
